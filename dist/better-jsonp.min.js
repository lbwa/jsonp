/*!
 * better-jsonp v1.1.1 Copyrights (c) 2018 Bowen (lbwa)
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.jsonp=t()}(this,function(){"use strict";function e(){}function t(e){return encodeURIComponent(e)}var n="callback",r=function(){function r(e){var t=e.url,r=e.timeout,o=void 0===r?6e3:r,i=e.jsonpCallback,c=void 0===i?""+n+Date.now():i,s=e.callbackParams,a=void 0===s?"jsonpCallback":s,l=e.urlParams,u=void 0===l?{}:l;this.checkOptions({url:t,jsonpCallback:c}),this.initState({timeout:o,jsonpCallback:c}),this.encodeURL({url:t,callbackParams:a,urlParams:u}),this.insert(this._url)}return r.prototype.checkOptions=function(e){var t=e.url,n=e.jsonpCallback;if(!t)throw new Error("Please check your request url.");if("jsonp"===n)throw new Error("Don't name jsonpCallback to `jsonp` for unexpected reset. Please use any non-jsonp value")},r.prototype.initState=function(e){var t=e.timeout,n=e.jsonpCallback;this.createScript(),this._jsonpCallback=n,this.handler=this.createHandler(),this.createTimer(t)},r.prototype.createScript=function(){this._reference=document.getElementsByTagName("script")[0]||document.body.lastElementChild,this._script=document.createElement("script")},r.prototype.createHandler=function(){var e=this;return new Promise(function(t,n){e._script.onerror=function(){e.cleanScript(),n(new Error("Countdown has been clear! JSONP request unsuccessfully due to 404/500"))},window[e._jsonpCallback]=function(n){e.cleanScript(),t(n)}})},r.prototype.createTimer=function(t){var n=this;t&&(this._timer=window.setTimeout(function(){throw window[n._jsonpCallback]=e,n._timer=null,n.cleanScript(),new Error("JSONP request unsuccessfully (eg.timeout or wrong url).")},t))},r.prototype.encodeURL=function(e){var n=e.url,r=e.callbackParams,o=e.urlParams,i=t(this._jsonpCallback);n+=(n.indexOf("?")<0?"?":"&")+r+"="+i,Object.keys(o).forEach(function(e){var r=void 0!==o[e]?o[e]:"";n+="&"+e+"="+t(r)}),this._url=n},r.prototype.insert=function(e){this._script.src=e,this._reference.parentNode.insertBefore(this._script,this._reference)},r.prototype.cleanScript=function(){this._script.parentNode&&(this._reference.parentNode.removeChild(this._script),this._script=null),window[this._jsonpCallback]=e,this._timer&&window.clearTimeout(this._timer)},r}();return function(e){return new r(e).handler}});
