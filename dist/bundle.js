!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.jsonp=e()}(this,function(){"use strict";function t(){}function e(t,e,i){Reflect.defineProperty(t,e,{enumerable:!1,writable:!0,value:i})}function i(t){return encodeURIComponent(t)}return class{constructor(t){this.checkOptions(t),this.initState(t),this.encodeURL(this._options.url),this.insertToElement(this._url)}checkOptions(t){if(!t.url)throw new Error("Please check your request url.");if(!t.callback)throw new Error("Please check your callback parameter.");this._options=t}initState(i){e(this,"_timer",null),e(this,"_url",null),e(this,"_id",null),e(this,"_insertScript",null),e(this,"_target",null);const s=i.timeout||6e3;if(i.callbackName)this._id=i.callbackName,e(this,"_callbackName",this._id);else{const t=i.prefix||"callback";this._id=t+Date.now()}window[this._id]=(t=>{this.cleanScript(),this._options.callback(t)}),s&&(this._timer=setTimeout(()=>{throw window[this._id]=t,this._timer=null,this.cleanScript(),new Error("JSONP request unsuccessfully (eg.timeout or wrong url).")},s))}encodeURL(t){const e=this._options.callbackParams||"jsonpCallback",s=i(this._id);t+=`${t.indexOf("?")<0?"?":"&"}${e}=${s}`;const r=this._options.urlParams||{};Object.keys(r).forEach(e=>{const s=void 0!==r[e]?r[e]:"";t+=`&${e}=${i(s)}`}),this._url=t}insertToElement(t){this._target=document.getElementsByTagName("script")[0]||document.body.lastElementChild,this._insertScript=document.createElement("script"),this._insertScript.src=t,this._target.parentNode.insertBefore(this._insertScript,this._target)}cleanScript(){this._insertScript.parentNode&&(this._target.parentNode.removeChild(this._insertScript),this._insertScript=null),window[this._id]=t,this._timer&&clearTimeout(this._timer)}}});
