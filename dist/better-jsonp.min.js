/*!
 * better-jsonp v1.1.0 Copyrights (c) 2018 Bowen (lbwa)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.jsonp=e()}(this,function(){"use strict";function t(){}function e(t,e,n){Reflect.defineProperty(t,e,{enumerable:!1,writable:!0,value:n})}function n(t){return encodeURIComponent(t)}var i={timeout:6e3,prefix:"callback",callbackParams:"jsonpCallback",urlParams:{}},r=function(){function r(t){this.checkOptions(t),this.initState(t),this.encodeURL(t.url),this.insertToElement(this._request)}return r.prototype.checkOptions=function(t){if(!t||!t.url)throw new Error("Please check your request url.");this.options=t},r.prototype.genJsonpCallback=function(t){if(t.jsonpCallback)this._jsonpCallback=t.jsonpCallback;else{var e=i.prefix;this._jsonpCallback=e+Date.now()}},r.prototype.defineGlobalCallback=function(){var t=this;return new Promise(function(e,n){t._insertScript.onerror=function(){t.cleanScript(),n(new Error("Countdown has been clear! JSONP request unsuccessfully due to 404/500"))},window[t._jsonpCallback]=function(n){t.cleanScript(),e(n)}})},r.prototype.genTimer=function(e){var n=this,r=e.timeout||i.timeout;r&&(this._timer=window.setTimeout(function(){throw window[n._jsonpCallback]=t,n._timer=0,n.cleanScript(),new Error("JSONP request unsuccessfully (eg.timeout or wrong url).")},r))},r.prototype.genScript=function(){this._target=document.getElementsByTagName("script")[0]||document.body.lastElementChild,this._insertScript=document.createElement("script")},r.prototype.initState=function(t){e(this,"_timer",null),e(this,"_request",null),e(this,"_jsonpCallback",null),e(this,"_insertScript",null),e(this,"_target",null),this.genScript(),this.genJsonpCallback(t),e(this,"_globalCallback",this.defineGlobalCallback()),this.genTimer(t)},r.prototype.encodeURL=function(t){var e=this.options.callbackParams||i.callbackParams,r=n(this._jsonpCallback);t+=(t.indexOf("?")<0?"?":"&")+e+"="+r;var o=this.options.urlParams||i.urlParams;Object.keys(o).forEach(function(e){var i=void 0!==o[e]?o[e]:"";t+="&"+e+"="+n(i)}),this._request=t},r.prototype.insertToElement=function(t){this._insertScript.src=t,this._target.parentNode.insertBefore(this._insertScript,this._target)},r.prototype.cleanScript=function(){this._insertScript.parentNode&&(this._target.parentNode.removeChild(this._insertScript),this._insertScript=null),window[this._jsonpCallback]=t,this._timer&&window.clearTimeout(this._timer)},r}();return function(t){return new r(t)._globalCallback}});
